@page "/login"
@using Microsoft.AspNetCore.Identity.Data
@using System.IdentityModel.Tokens.Jwt;
@inject HttpClient Http
@inject NavigationManager NavigationManager

<h3>Login</h3>

<EditForm Model="@form" OnValidSubmit="HandleValidSubmit">
    <div class="content__boxed w-100 min-vh-100 d-flex flex-column align-items-center justify-content-center">
        <div class="content__wrap">

            <!-- Login card -->
            <div class="card shadow-lg">
                <div class="card-body">

                    <div class="text-center">
                        <h1 class="h3">Account Login</h1>
                        <p>Sign In to your account</p>
                    </div>

                    <form class="mt-4" action="index.html">

                        <div class="mb-3">
                            <input type="text" class="form-control" placeholder="Username" autofocus>
                        </div>

                        <div class="mb-3">
                            <input type="password" class="form-control" placeholder="Password">
                        </div>

                        <div class="form-check">
                            <input id="_dm-loginCheck" class="form-check-input" type="checkbox">
                            <label for="_dm-loginCheck" class="form-check-label">
                                Remember me
                            </label>
                        </div>

                        <div class="d-grid mt-5">
                            <button class="btn btn-primary btn-lg" type="submit">Sign In</button>
                        </div>
                    </form>

                    <div class="d-flex justify-content-between mt-4">
                        <a href="#" class="btn-link text-decoration-none">Forgot password ?</a>
                        <a href="#" class="btn-link text-decoration-none">Create a new account</a>
                    </div>

                    <div class="d-flex align-items-center justify-content-between border-top pt-3 mt-3">
                        <h5 class="m-0">Login with</h5>

                        <!-- Social media buttons -->
                        <div class="ms-3">
                            <a href="#" class="btn btn-sm btn-icon btn-hover btn-primary text-inherit">
                                <i class="psi-facebook fs-5"></i>
                            </a>
                            <a href="#" class="btn btn-sm btn-icon btn-hover btn-info text-inherit">
                                <i class="psi-twitter fs-5"></i>
                            </a>
                            <a href="#" class="btn btn-sm btn-icon btn-hover btn-danger text-inherit">
                                <i class="psi-google-plus fs-5"></i>
                            </a>
                            <a href="#" class="btn btn-sm btn-icon btn-hover btn-warning text-inherit">
                                <i class="psi-instagram fs-5"></i>
                            </a>
                        </div>
                        <!-- END : Social media buttons -->

                    </div>

                </div>
            </div>
            <!-- END : Login card -->

            <!-- Demonstration purposes -->
            <div class="d-flex align-items-center justify-content-center gap-3 mt-4">
                <button type="button" onclick="window.history.back()" class="btn btn-light">Go back</button>
                <a href="/" class="btn btn-primary">Return home</a>
            </div>
            <!-- END : Demonstration purposes -->

        </div>
    </div>
    <div class="mb-3">
        <label for="username" class="form-label">Username</label>
        <InputText id="username" class="form-control" @bind-Value="form.Email"/>
    </div>
    <div class="mb-3">
        <label for="password" class="form-label">Password</label>
        <InputText id="password" type="password" class="form-control" @bind-Value="form.Password"/>
    </div>
    <button type="submit" class="btn btn-primary">Submit</button>
</EditForm>

@code {
    private class LoginFormModel
    {
        public string Email { get; set; }
        public string Password { get; set; }
    }

    private LoginFormModel form = new LoginFormModel();
    private JwtSecurityToken jwtToken = null;

    private async void HandleValidSubmit()
    {
        // var user = new LoginRequest(email, password);
        Console.WriteLine("OnValidSubmit");
        var response = await Http.GetAsync("http://localhost:5117/login");

        // if (user.Email == "sury@example.com" && user.Password == "Martinez")
        // {
        //     jwtToken = "Test Token admin";
        //     // Navigate to Counter page
        //     NavigationManager.NavigateTo("/counter");
        // }
        // else
        // {
        //     jwtToken = "Error al login";
        // }
    }
}
